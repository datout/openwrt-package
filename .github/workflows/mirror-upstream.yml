      - name: Mirror all upstream branches to this repo
        shell: bash
        run: |
          set -euo pipefail

          set -euo pipefail

# 只取 upstream 下真正的远程分支：refs/remotes/upstream/<branch>
BRANCHES="$(git for-each-ref --format='%(refname:strip=3)' refs/remotes/upstream/* \
  | grep -v '^HEAD
 \
  | sort -u)"

echo "Upstream branches:"
echo "$BRANCHES"

for b in $BRANCHES; do
  echo "==> Sync branch: $b"
  git checkout -B "$b" "upstream/$b"
  git push -f origin "$b"
done

git checkout main || true
